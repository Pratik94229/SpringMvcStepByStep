## What we want to do:
- Understand importance of DispatcherServlet.
- Add Logging Framework Log4j to understand the flow much more. 

## Spring MVC Request Flow

1. **DispatcherServlet receives HTTP Request**:
   When a user sends an HTTP request to the server, the request is first intercepted by the DispatcherServlet. The DispatcherServlet is essentially the entry point for all requests in a Spring MVC application.

2. **DispatcherServlet identifies the right Controller based on the URL**:
   The DispatcherServlet examines the URL of the incoming request to determine which controller should handle the request. It uses a set of mappings (usually defined in the application's configuration) to determine the appropriate controller.

3. **Controller executes Business Logic**:
   Once the DispatcherServlet has identified the correct controller, it dispatches the request to that controller. The controller contains the application's business logic, which is responsible for processing the request, performing any necessary operations, and preparing data for the response.

4. **Controller returns Model and View Name Back to DispatcherServlet**:
   After executing the business logic, the controller typically prepares two things:
   - Model: This is the data that the controller wants to make available to the view for rendering. It could be a single object, a collection, or any other data structure.
   - View Name: This is the logical name of the view that should be rendered to display the response. It's usually a string that corresponds to a specific view template.

5. **DispatcherServlet identifies the correct view (ViewResolver)**:
   The DispatcherServlet takes the view name returned by the controller and uses a ViewResolver to map it to an actual view template. The ViewResolver is responsible for resolving the logical view name to the actual view template file, which could be a JSP, Thymeleaf template, FreeMarker template, etc.

6. **DispatcherServlet makes the model available to view and executes it**:
   Once the view template is determined, the DispatcherServlet makes the model data prepared by the controller available to the view template. It then executes the view template, passing in the model data for rendering.

7. **DispatcherServlet returns HTTP Response Back**:
   Finally, the DispatcherServlet generates an HTTP response based on the output of the view template rendering. This response typically includes HTML content generated by the view, along with any additional HTTP headers or status codes required. The response is then sent back to the client that made the original request.

In summary, the DispatcherServlet plays a crucial role in the request processing lifecycle of a Spring MVC application, handling incoming requests, dispatching them to the appropriate controllers, coordinating the execution of business logic, rendering views, and ultimately sending back HTTP responses to clients.

In simple terms,

1. **DispatcherServlet gets a request**:
   Think of DispatcherServlet as the gatekeeper of a web application. When someone wants to see a webpage (by typing a URL or clicking a link), DispatcherServlet is the first thing that gets the request.

2. **DispatcherServlet figures out which part of the code should handle the request**:
   Imagine you're in a big library, and you ask the librarian for a specific book. DispatcherServlet is like the librarian who knows which shelf to go to find that book. It looks at the URL you asked for and decides which "shelf" (or part of the code) has the instructions for handling that request.

3. **That part of the code does its job**:
   Once DispatcherServlet finds the right place in the code, that part starts working. It might do calculations, fetch information from a database, or anything else the website needs to do.

4. **The code decides what information should be sent back to you**:
   Imagine you asked the librarian for information about a book. The librarian goes to find that information and then decides what to tell you. Similarly, the code decides what data (like a list of books, or some details) should be sent back to your browser.

5. **DispatcherServlet figures out how to show you the information**:
   Now, think of DispatcherServlet as a wizard who knows how to turn that information into something you can see on your screen. It finds the right "spell" (or template) to use to make the information look nice.

6. **The wizard puts everything together and shows it to you**:
   DispatcherServlet combines the information from the code with the right template and creates a webpage that you can see on your browser.

7. **You see the webpage on your screen**:
   Finally, the webpage appears on your computer screen, and you can read the information or interact with the website. This is all thanks to DispatcherServlet and the other parts of the code working together behind the scenes.

So, in simple terms, DispatcherServlet is like the traffic cop of a web application, directing requests to the right place in the code, making sure everything runs smoothly, and showing you the webpage you asked for.
- Flow : http://docs.spring.io/spring-framework/docs/2.0.8/reference/images/mvc.png

## Files List
### /pom.xml
```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>com.in28minutes</groupId>
	<artifactId>in28Minutes-springmvc</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<packaging>war</packaging>

	<dependencies>
		<dependency>
			<groupId>javax</groupId>
			<artifactId>javaee-web-api</artifactId>
			<version>6.0</version>
			<scope>provided</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-webmvc</artifactId>
			<version>4.2.2.RELEASE</version>
		</dependency>

		<dependency>
			<groupId>log4j</groupId>
			<artifactId>log4j</artifactId>
			<version>1.2.17</version>
		</dependency>
	</dependencies>

	<build>
		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-compiler-plugin</artifactId>
					<version>3.2</version>
					<configuration>
						<verbose>true</verbose>
						<source>1.8</source>
						<target>1.8</target>
						<showWarnings>true</showWarnings>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.apache.tomcat.maven</groupId>
					<artifactId>tomcat7-maven-plugin</artifactId>
					<version>2.2</version>
					<configuration>
						<path>/</path>
						<contextReloadable>true</contextReloadable>
					</configuration>
				</plugin>
			</plugins>
		</pluginManagement>
	</build>
</project>
```
### /src/main/java/com/in28minutes/jee/LoginService.java
```
package com.in28minutes.jee;

public class LoginService {
	public boolean validateUser(String user, String password) {
		return user.equalsIgnoreCase("in28Minutes") && password.equals("dummy");
	}

}
```
### /src/main/java/com/in28minutes/jee/LoginServlet.java
```
package com.in28minutes.jee;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet(urlPatterns = "/login.do")
public class LoginServlet extends HttpServlet {

	private LoginService service = new LoginService();

	@Override
	protected void doGet(HttpServletRequest request,
			HttpServletResponse response) throws IOException, ServletException {
		request.getRequestDispatcher("/WEB-INF/views/login.jsp").forward(
				request, response);
	}

	@Override
	protected void doPost(HttpServletRequest request,
			HttpServletResponse response) throws IOException, ServletException {
		String name = request.getParameter("name");
		String password = request.getParameter("password");

		boolean isValidUser = service.validateUser(name, password);

		if (isValidUser) {
			request.setAttribute("name", name);
			request.getRequestDispatcher("/WEB-INF/views/welcome.jsp").forward(
					request, response);
		} else {
			request.setAttribute("errorMessage", "Invalid Credentials!!");
			request.getRequestDispatcher("/WEB-INF/views/login.jsp").forward(
					request, response);
		}
	}

}
```
### /src/main/java/com/in28minutes/springmvc/login/LoginController.java
```
package com.in28minutes.springmvc.login;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

@Controller
public class LoginController {
	@RequestMapping(value = "/login", method = RequestMethod.GET)
	public String showLoginPage() {
		return "login";
	}
}
```
### /src/main/resources/log4j.properties
```
log4j.rootLogger=TRACE, Appender1, Appender2
 
log4j.appender.Appender1=org.apache.log4j.ConsoleAppender
log4j.appender.Appender1.layout=org.apache.log4j.PatternLayout
log4j.appender.Appender1.layout.ConversionPattern=%-7p %d [%t] %c %x - %m%n
 
```
### /src/main/webapp/WEB-INF/todo-servlet.xml
```
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:component-scan base-package="com.in28minutes" />

    <mvc:annotation-driven />
    
    <bean
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix">
            <value>/WEB-INF/views/</value>
        </property>
        <property name="suffix">
            <value>.jsp</value>
        </property>
    </bean>
    
</beans>
```
### /src/main/webapp/WEB-INF/views/login.jsp
```
<html>
<head>
<title>Yahoo!!</title>
</head>
<body>
    <p><font color="red">${errorMessage}</font></p>
    <form action="/spring-mvc/login" method="POST">
        Name : <input name="name" type="text" /> Password : <input name="password" type="password" /> <input type="submit" />
    </form>
</body>
</html>
```
### /src/main/webapp/WEB-INF/views/welcome.jsp
```
<html>
<head>
<title>Yahoo!!</title>
</head>
<body>
Welcome ${name}. 
</body>
</html>
```
### /src/main/webapp/WEB-INF/web.xml
```
<web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
    version="3.0">

    <display-name>To do List</display-name>

    <servlet>
        <servlet-name>dispatcher</servlet-name>
        <servlet-class>
            org.springframework.web.servlet.DispatcherServlet
        </servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/todo-servlet.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>dispatcher</servlet-name>
        <url-pattern>/spring-mvc/*</url-pattern>
    </servlet-mapping>
</web-app>
```
